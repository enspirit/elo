---
import Layout from '../layouts/Layout.astro';
import Footer from '../components/Footer.astro';

const base = import.meta.env.BASE_URL.replace(/\/$/, '');
const url = (path: string) => `${base}${path}`;
---

<Layout title="Learn Elo" activeNav="learn">
  <main class="learn-panel" data-controller="doc learn-progress exercises">
    <aside class="learn-toc">
      <nav>
        <span class="toc-section">Chapters</span>
        <a href="#chapter-1" data-learn-progress-target="tocLink"><span class="toc-check"></span>1. Introduction</a>
        <a href="#chapter-2" data-learn-progress-target="tocLink"><span class="toc-check"></span>2. Extended Arithmetics</a>
        <a href="#chapter-3" data-learn-progress-target="tocLink"><span class="toc-check"></span>3. Data Structures</a>
        <a href="#chapter-4" data-learn-progress-target="tocLink"><span class="toc-check"></span>4. Functions</a>
        <a href="#chapter-5" data-learn-progress-target="tocLink"><span class="toc-check"></span>5. Program Structure</a>
        <a href="#chapter-6" data-learn-progress-target="tocLink"><span class="toc-check"></span>6. Advanced Processing</a>
        <a href="#chapter-7" data-learn-progress-target="tocLink"><span class="toc-check"></span>7. Input Data</a>
        <span class="toc-section">Exercises</span>
        <a href="#ex-area" data-exercises-target="tocLink"><span class="toc-check"></span>Rectangle Area</a>
        <a href="#ex-filter-map" data-exercises-target="tocLink"><span class="toc-check"></span>Filter and Double</a>
        <span class="toc-section">Next</span>
        <a href="#chapter-next">What's Next?</a>
      </nav>
    </aside>
    <article class="learn-content">
      <header class="page-header">
        <h1>Learn Elo</h1>
        <p class="page-intro">
          Elo is an expression language that compiles to JavaScript, Ruby, and SQL.
          Think of it as an extended calculator: you write expressions, Elo gives you results.
          Let's explore what makes Elo special.
        </p>
      </header>

      <section class="lesson" id="chapter-1" data-learn-progress-target="lesson">
        <div class="lesson-header">
          <h2>1. Introduction</h2>
          <button class="lesson-toggle" data-action="click->learn-progress#toggle" data-lesson="chapter-1" data-learn-progress-target="toggleBtn">
            <span class="toggle-check"></span><span class="toggle-text">Mark as complete</span>
          </button>
        </div>
        <p>
          Here's a taste of what Elo can do. Don't worry if you don't understand everything yet—
          that's what the next chapters are for!
        </p>
        <div class="lesson-example" data-action="click->doc#tryExample">
          <pre class="example-code">let
  signup = D2024-01-15,
  trial = P30D
in
  TODAY > signup + trial</pre>
        </div>
        <p>
          This checks if a 30-day trial has expired. Notice how naturally Elo handles dates and durations.
        </p>
        <div class="lesson-example" data-action="click->doc#tryExample">
          <pre class="example-code">[10, 25, 5, 30] |> filter(x ~> x > 15) |> map(x ~> x * 1.21)</pre>
        </div>
        <p>
          This filters a list to keep values above 15, then applies VAT to each. Data flows left to right.
        </p>
        <div class="lesson-example" data-action="click->doc#tryExample">
          <pre class="example-code">_.email |> lower |> endsWith('@company.com')</pre>
        </div>
        <p>
          This checks if an input email belongs to a company domain. The <code>_</code> is input data.
        </p>
        <p class="lesson-tip">
          <strong>Write once, run anywhere:</strong> These expressions compile to JavaScript, Ruby, and SQL.
          The same logic works in your browser, on your server, or in your database.
        </p>
      </section>

      <section class="lesson" id="chapter-2" data-learn-progress-target="lesson">
        <div class="lesson-header">
          <h2>2. Extended Arithmetics</h2>
          <button class="lesson-toggle" data-action="click->learn-progress#toggle" data-lesson="chapter-2" data-learn-progress-target="toggleBtn">
            <span class="toggle-check"></span><span class="toggle-text">Mark as complete</span>
          </button>
        </div>
        <p>
          You know how calculators work with numbers. Elo extends this idea to other types.
          The same operators (<code>+</code>, <code>-</code>, <code>*</code>) work on different kinds of data.
        </p>

        <h3>Numbers</h3>
        <p>Just like a calculator:</p>
        <div class="lesson-example" data-action="click->doc#tryExample">
          <pre class="example-code">2 + 3 * 4</pre>
        </div>
        <div class="lesson-example" data-action="click->doc#tryExample">
          <pre class="example-code">2 ^ 10</pre>
        </div>

        <h3>Booleans</h3>
        <p>True/false values with <code>and</code>, <code>or</code>, <code>not</code>:</p>
        <div class="lesson-example" data-action="click->doc#tryExample">
          <pre class="example-code">5 > 3 and 10 <= 10</pre>
        </div>
        <div class="lesson-example" data-action="click->doc#tryExample">
          <pre class="example-code">not (1 == 2) or false</pre>
        </div>

        <h3>Strings</h3>
        <p>Text with <code>+</code> for concatenation, <code>*</code> for repetition:</p>
        <div class="lesson-example" data-action="click->doc#tryExample">
          <pre class="example-code">'Hello, ' + 'World!'</pre>
        </div>
        <div class="lesson-example" data-action="click->doc#tryExample">
          <pre class="example-code">'ho! ' * 3</pre>
        </div>

        <h3>Dates &amp; Durations</h3>
        <p>Dates start with <code>D</code>, durations with <code>P</code> (ISO 8601):</p>
        <div class="lesson-example" data-action="click->doc#tryExample">
          <pre class="example-code">D2024-12-25</pre>
        </div>
        <div class="lesson-example" data-action="click->doc#tryExample">
          <pre class="example-code">TODAY + P30D</pre>
        </div>
        <div class="lesson-example" data-action="click->doc#tryExample">
          <pre class="example-code">NOW + PT2H30M</pre>
        </div>
        <p>
          You can subtract dates to get durations, and scale durations:
        </p>
        <div class="lesson-example" data-action="click->doc#tryExample">
          <pre class="example-code">D2024-12-31 - D2024-01-01</pre>
        </div>
        <div class="lesson-example" data-action="click->doc#tryExample">
          <pre class="example-code">P1D * 7</pre>
        </div>

        <p class="lesson-tip">
          <strong>The pattern:</strong> Operators like <code>+</code>, <code>-</code>, <code>*</code> are not just for numbers.
          Each type defines what these operations mean. See the <a href={url('/stdlib')}>stdlib</a> for all type-specific operations.
        </p>
      </section>

      <section class="lesson" id="chapter-3" data-learn-progress-target="lesson">
        <div class="lesson-header">
          <h2>3. Data Structures</h2>
          <button class="lesson-toggle" data-action="click->learn-progress#toggle" data-lesson="chapter-3" data-learn-progress-target="toggleBtn">
            <span class="toggle-check"></span><span class="toggle-text">Mark as complete</span>
          </button>
        </div>
        <p>
          Real data comes in structures: records with fields, collections of items. Elo has two main structures.
        </p>

        <h3>Tuples</h3>
        <p>Named fields, like a record or JSON object:</p>
        <div class="lesson-example" data-action="click->doc#tryExample">
          <pre class="example-code">&#123; name: 'Alice', age: 30, city: 'Brussels' &#125;</pre>
        </div>
        <p>Access fields with a dot:</p>
        <div class="lesson-example" data-action="click->doc#tryExample">
          <pre class="example-code">&#123; name: 'Alice', age: 30 &#125;.name</pre>
        </div>

        <h3>Lists</h3>
        <p>Ordered collections in square brackets:</p>
        <div class="lesson-example" data-action="click->doc#tryExample">
          <pre class="example-code">[1, 2, 3, 4, 5]</pre>
        </div>
        <div class="lesson-example" data-action="click->doc#tryExample">
          <pre class="example-code">['apple', 'banana'] + ['cherry']</pre>
        </div>
        <p>Get elements by position:</p>
        <div class="lesson-example" data-action="click->doc#tryExample">
          <pre class="example-code">first([10, 20, 30])</pre>
        </div>
        <div class="lesson-example" data-action="click->doc#tryExample">
          <pre class="example-code">at([10, 20, 30], 1)</pre>
        </div>

        <h3>Data Paths &amp; Fetch</h3>
        <p>Navigate nested data safely with paths:</p>
        <div class="lesson-example" data-action="click->doc#tryExample">
          <pre class="example-code">let data = &#123; user: &#123; name: 'Alice' &#125; &#125; in fetch(data, .user.name)</pre>
        </div>
        <p>Paths start with a dot. <code>fetch</code> returns <code>null</code> if any part is missing:</p>
        <div class="lesson-example" data-action="click->doc#tryExample">
          <pre class="example-code">let data = &#123; user: null &#125; in fetch(data, .user.name) | 'Unknown'</pre>
        </div>

        <p class="lesson-tip">
          <strong>Think JSON:</strong> Tuples and lists work just like JSON objects and arrays.
          Elo makes them first-class citizens with operators and safe navigation.
        </p>
      </section>

      <section class="lesson" id="chapter-4" data-learn-progress-target="lesson">
        <div class="lesson-header">
          <h2>4. Functions</h2>
          <button class="lesson-toggle" data-action="click->learn-progress#toggle" data-lesson="chapter-4" data-learn-progress-target="toggleBtn">
            <span class="toggle-check"></span><span class="toggle-text">Mark as complete</span>
          </button>
        </div>
        <p>
          Operators are great, but sometimes you need more. Elo has a standard library of functions,
          and you can define your own.
        </p>

        <h3>Standard Library</h3>
        <p>Built-in functions for common operations:</p>
        <div class="lesson-example" data-action="click->doc#tryExample">
          <pre class="example-code">upper('hello')</pre>
        </div>
        <div class="lesson-example" data-action="click->doc#tryExample">
          <pre class="example-code">abs(-42)</pre>
        </div>
        <div class="lesson-example" data-action="click->doc#tryExample">
          <pre class="example-code">year(TODAY)</pre>
        </div>
        <div class="lesson-example" data-action="click->doc#tryExample">
          <pre class="example-code">length([1, 2, 3])</pre>
        </div>

        <h3>Lambdas</h3>
        <p>Define your own functions with <code>fn</code>:</p>
        <div class="lesson-example" data-action="click->doc#tryExample">
          <pre class="example-code">let double = fn(x ~> x * 2) in double(21)</pre>
        </div>
        <div class="lesson-example" data-action="click->doc#tryExample">
          <pre class="example-code">let greet = fn(name ~> 'Hello, ' + name + '!') in greet('Elo')</pre>
        </div>
        <p>Functions can take multiple parameters:</p>
        <div class="lesson-example" data-action="click->doc#tryExample">
          <pre class="example-code">let add = fn(a, b ~> a + b) in add(3, 4)</pre>
        </div>

        <h3>Sugar Syntax</h3>
        <p>For single-parameter lambdas, you can skip <code>fn()</code>:</p>
        <div class="lesson-example" data-action="click->doc#tryExample">
          <pre class="example-code">map([1, 2, 3], x ~> x * 2)</pre>
        </div>

        <p class="lesson-tip">
          <strong>Functions are values:</strong> You can pass functions to other functions, store them in variables,
          and return them. This is key for list processing in Chapter 6.
          Explore all <a href={url('/stdlib')}>stdlib functions</a>.
        </p>
      </section>

      <section class="lesson" id="chapter-5" data-learn-progress-target="lesson">
        <div class="lesson-header">
          <h2>5. Program Structure</h2>
          <button class="lesson-toggle" data-action="click->learn-progress#toggle" data-lesson="chapter-5" data-learn-progress-target="toggleBtn">
            <span class="toggle-check"></span><span class="toggle-text">Mark as complete</span>
          </button>
        </div>
        <p>
          Complex expressions need structure. Elo provides three key constructs.
        </p>

        <h3>Let Bindings</h3>
        <p>Name intermediate values to avoid repetition:</p>
        <div class="lesson-example" data-action="click->doc#tryExample">
          <pre class="example-code">let price = 100 in price * 1.21</pre>
        </div>
        <div class="lesson-example" data-action="click->doc#tryExample">
          <pre class="example-code">let width = 10, height = 5 in width * height</pre>
        </div>
        <p>Names don't change—once bound, a value stays the same. No surprises!</p>

        <h3>Conditionals</h3>
        <p>Choose between values with <code>if</code>/<code>then</code>/<code>else</code>:</p>
        <div class="lesson-example" data-action="click->doc#tryExample">
          <pre class="example-code">if 5 > 3 then 'yes' else 'no'</pre>
        </div>
        <div class="lesson-example" data-action="click->doc#tryExample">
          <pre class="example-code">let age = 25 in if age >= 18 then 'adult' else 'minor'</pre>
        </div>
        <p>In Elo, <code>if</code> is an expression—it always produces a value.</p>

        <h3>Pipe Operator</h3>
        <p>Chain operations left-to-right with <code>|&gt;</code>:</p>
        <div class="lesson-example" data-action="click->doc#tryExample">
          <pre class="example-code">'  hello  ' |> trim |> upper</pre>
        </div>
        <p>Compare with nested calls:</p>
        <div class="lesson-example" data-action="click->doc#tryExample">
          <pre class="example-code">upper(trim('  hello  '))</pre>
        </div>
        <p>The pipe version reads naturally: take this, then do that, then that.</p>
        <div class="lesson-example" data-action="click->doc#tryExample">
          <pre class="example-code">'42' |> Int |> fn(n ~> n * 2)</pre>
        </div>

        <p class="lesson-tip">
          <strong>Assembly line:</strong> Data flows through the pipe, getting transformed at each step.
          Much cleaner than deeply nested parentheses!
        </p>
      </section>

      <section class="lesson" id="chapter-6" data-learn-progress-target="lesson">
        <div class="lesson-header">
          <h2>6. Advanced Processing</h2>
          <button class="lesson-toggle" data-action="click->learn-progress#toggle" data-lesson="chapter-6" data-learn-progress-target="toggleBtn">
            <span class="toggle-check"></span><span class="toggle-text">Mark as complete</span>
          </button>
        </div>
        <p>
          Now we combine functions and lists for powerful data processing.
        </p>

        <h3>Map, Filter, Reduce</h3>
        <p><code>map</code> transforms each element:</p>
        <div class="lesson-example" data-action="click->doc#tryExample">
          <pre class="example-code">map([1, 2, 3], x ~> x * 2)</pre>
        </div>
        <p><code>filter</code> keeps elements that match:</p>
        <div class="lesson-example" data-action="click->doc#tryExample">
          <pre class="example-code">filter([1, 2, 3, 4, 5], x ~> x > 2)</pre>
        </div>
        <p><code>reduce</code> combines all elements into one value:</p>
        <div class="lesson-example" data-action="click->doc#tryExample">
          <pre class="example-code">reduce([1, 2, 3, 4], 0, fn(sum, x ~> sum + x))</pre>
        </div>
        <p>Chain them together:</p>
        <div class="lesson-example" data-action="click->doc#tryExample">
          <pre class="example-code">[1, 2, 3, 4, 5] |> filter(x ~> x > 2) |> map(x ~> x * 10)</pre>
        </div>

        <h3>Null Handling</h3>
        <p>Missing data is represented by <code>null</code>. The <code>|</code> operator provides fallbacks:</p>
        <div class="lesson-example" data-action="click->doc#tryExample">
          <pre class="example-code">null | 'default'</pre>
        </div>
        <div class="lesson-example" data-action="click->doc#tryExample">
          <pre class="example-code">indexOf('hello', 'x') | -1</pre>
        </div>
        <p>Use <code>isNull</code> to check:</p>
        <div class="lesson-example" data-action="click->doc#tryExample">
          <pre class="example-code">isNull(null)</pre>
        </div>

        <h3>Type Selectors</h3>
        <p>Parse strings into typed values:</p>
        <div class="lesson-example" data-action="click->doc#tryExample">
          <pre class="example-code">Int('42')</pre>
        </div>
        <div class="lesson-example" data-action="click->doc#tryExample">
          <pre class="example-code">Date('2024-12-25')</pre>
        </div>
        <div class="lesson-example" data-action="click->doc#tryExample">
          <pre class="example-code">Int('not a number') | 0</pre>
        </div>

        <p class="lesson-tip">
          <strong>Robust processing:</strong> Combine <code>|</code> with type selectors for safe parsing.
          Invalid input returns <code>null</code>, which you catch with a fallback.
        </p>
      </section>

      <section class="lesson" id="chapter-7" data-learn-progress-target="lesson">
        <div class="lesson-header">
          <h2>7. Input Data</h2>
          <button class="lesson-toggle" data-action="click->learn-progress#toggle" data-lesson="chapter-7" data-learn-progress-target="toggleBtn">
            <span class="toggle-check"></span><span class="toggle-text">Mark as complete</span>
          </button>
        </div>
        <p>
          So far we've worked with literal values. Real programs process external data.
          In Elo, input is accessed through the special <code>_</code> variable.
        </p>

        <h3>The Input Variable</h3>
        <p>When you use <code>_</code>, your expression becomes a function:</p>
        <div class="lesson-example" data-action="click->doc#tryExample">
          <pre class="example-code">_ * 2</pre>
        </div>
        <p>Access fields of input data:</p>
        <div class="lesson-example" data-action="click->doc#tryExample">
          <pre class="example-code">_.price * _.quantity</pre>
        </div>
        <div class="lesson-example" data-action="click->doc#tryExample">
          <pre class="example-code">_.name |> upper</pre>
        </div>

        <h3>Data Transformation</h3>
        <p>Elo expressions are data transformations: input flows in, result flows out.</p>
        <div class="lesson-example" data-action="click->doc#tryExample">
          <pre class="example-code">_.items |> map(x ~> x.price) |> reduce(0, fn(sum, p ~> sum + p))</pre>
        </div>
        <div class="lesson-example" data-action="click->doc#tryExample">
          <pre class="example-code">if _.status == 'active' then _.budget * 1.1 else _.budget</pre>
        </div>

        <h3>Try It</h3>
        <p>
          In the <a href={url('/playground')}>playground</a>, enter input data as JSON in the bottom panel.
          For example, with input <code>&#123;"price": 100, "quantity": 3&#125;</code>:
        </p>
        <div class="lesson-example" data-action="click->doc#tryExample">
          <pre class="example-code">_.price * _.quantity</pre>
        </div>

        <p class="lesson-tip">
          <strong>Think transformations:</strong> Every Elo expression with <code>_</code> is a reusable transformation.
          The same expression works whether it runs in your browser (JS), server (Ruby), or database (SQL).
        </p>
      </section>

      <section class="exercises-section" id="exercises-intro">
        <h2>Exercises</h2>
        <p class="exercises-intro">
          Practice what you've learned! Each exercise comes with assertions that must pass.
          Replace the <code>???</code> placeholders with your code, then click "Check" to verify.
        </p>
      </section>

      <section class="exercise" id="ex-area" data-exercises-target="exercise">
        <div class="exercise-header">
          <h3>Rectangle Area</h3>
          <span class="exercise-chapter">Chapter 2</span>
        </div>
        <p class="exercise-description">
          Calculate the area of a rectangle. The width is 8 and the height is 5.
          Store them in variables and compute the area.
        </p>
        <div
          class="exercise-editor"
          data-exercises-target="editor"
          data-exercise-id="ex-area"
          data-initial-code={`let
  width = ???,
  height = ???
in
  assert(width * height == 40)`}
        ></div>
        <div class="exercise-actions">
          <button
            class="exercise-check"
            data-action="click->exercises#check"
            data-exercises-target="checkButton"
            data-exercise-id="ex-area"
          >Check</button>
          <button
            class="exercise-solution-toggle"
            data-action="click->exercises#toggleSolution"
            data-exercises-target="solutionButton"
            data-exercise-id="ex-area"
          >Show Solution</button>
        </div>
        <div
          class="exercise-feedback"
          data-exercises-target="feedback"
          data-exercise-id="ex-area"
        ></div>
        <div
          class="exercise-solution hidden"
          data-exercises-target="solution"
          data-exercise-id="ex-area"
        >
          <h4>Solution</h4>
          <pre class="example-code">let
  width = 8,
  height = 5
in
  assert(width * height == 40)</pre>
        </div>
      </section>

      <section class="exercise" id="ex-filter-map" data-exercises-target="exercise">
        <div class="exercise-header">
          <h3>Filter and Double</h3>
          <span class="exercise-chapter">Chapter 6</span>
        </div>
        <p class="exercise-description">
          Given a list of numbers, keep only those greater than 10, then double each remaining value.
        </p>
        <div
          class="exercise-editor"
          data-exercises-target="editor"
          data-exercise-id="ex-filter-map"
          data-initial-code={`let
  numbers = [5, 12, 8, 20, 3, 15]
in
  numbers
    |> filter(???)
    |> map(???)
    |> fn(result ~> assert(result == [24, 40, 30]))`}
        ></div>
        <div class="exercise-actions">
          <button
            class="exercise-check"
            data-action="click->exercises#check"
            data-exercises-target="checkButton"
            data-exercise-id="ex-filter-map"
          >Check</button>
          <button
            class="exercise-solution-toggle"
            data-action="click->exercises#toggleSolution"
            data-exercises-target="solutionButton"
            data-exercise-id="ex-filter-map"
          >Show Solution</button>
        </div>
        <div
          class="exercise-feedback"
          data-exercises-target="feedback"
          data-exercise-id="ex-filter-map"
        ></div>
        <div
          class="exercise-solution hidden"
          data-exercises-target="solution"
          data-exercise-id="ex-filter-map"
        >
          <h4>Solution</h4>
          <pre class="example-code">let
  numbers = [5, 12, 8, 20, 3, 15]
in
  numbers
    |> filter(x ~> x > 10)
    |> map(x ~> x * 2)
    |> fn(result ~> assert(result == [24, 40, 30]))</pre>
        </div>
      </section>

      <section class="lesson" id="chapter-next">
        <h2>What's Next?</h2>
        <p>
          You've learned the core of Elo and practiced with exercises. Now explore further:
        </p>
        <ul class="next-steps">
          <li>
            <a href={url('/playground')}><strong>Try the Playground</strong></a>
            — Experiment with everything you've learned
          </li>
          <li>
            <a href={url('/docs')}><strong>Read the Reference</strong></a>
            — Dive deeper into Elo's features
          </li>
          <li>
            <a href={url('/stdlib')}><strong>Explore the Stdlib</strong></a>
            — Discover all built-in operators and functions
          </li>
        </ul>
        <p class="lesson-closing">
          Remember: Elo compiles to JavaScript, Ruby, and SQL. Write once, run anywhere.
          <br>Happy coding!
        </p>
      </section>

      <Footer className="learn-footer" />
    </article>
  </main>
</Layout>
